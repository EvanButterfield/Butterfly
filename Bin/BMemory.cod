; Listing generated by Microsoft (R) Optimizing Compiler Version 19.34.31935.0 

include listing.inc

INCLUDELIB LIBCMTD
INCLUDELIB OLDNAMES

PUBLIC	MemTypeStrings
_DATA	SEGMENT
MemTypeStrings DQ FLAT:$SG117905
	DQ	FLAT:$SG117906
$SG117905 DB	'[Memory Type Unknown]', 00H
	ORG $+2
$SG117906 DB	'[Memory Type String] ', 00H
_DATA	ENDS
PUBLIC	BAlloc
PUBLIC	BFree
PUBLIC	BPrintMemUsage
EXTRN	BPlatformAlloc:PROC
EXTRN	BPlatformFree:PROC
EXTRN	BLogMessage:PROC
_BSS	SEGMENT
MemoryStats DB	018H DUP (?)
_BSS	ENDS
pdata	SEGMENT
$pdata$BAlloc DD imagerel $LN4
	DD	imagerel $LN4+131
	DD	imagerel $unwind$BAlloc
$pdata$BFree DD	imagerel $LN4
	DD	imagerel $LN4+134
	DD	imagerel $unwind$BFree
$pdata$BPrintMemUsage DD imagerel $LN6
	DD	imagerel $LN6+130
	DD	imagerel $unwind$BPrintMemUsage
pdata	ENDS
_DATA	SEGMENT
	ORG $+2
$SG117914 DB	'"BAlloc" called with "MEM_TYPE_UNKNOWN", please re-type '
	DB	'this', 00H
	ORG $+3
$SG117915 DB	'[Engine]: ', 00H
	ORG $+5
$SG117924 DB	'"BFree" called with "MEM_TYPE_UNKNOWN", please re-type t'
	DB	'his', 00H
	ORG $+4
$SG117925 DB	'[Engine]: ', 00H
	ORG $+5
$SG117932 DB	'Total Memory Allocated: %lu bytes', 00H
	ORG $+6
$SG117933 DB	'[Engine]: ', 00H
	ORG $+5
$SG117934 DB	'Total Memory Allocated for %s is %lu bytes', 00H
	ORG $+5
$SG117935 DB	'[Engine]: ', 00H
_DATA	ENDS
xdata	SEGMENT
$unwind$BAlloc DD 010d01H
	DD	0620dH
$unwind$BFree DD 011201H
	DD	04212H
$unwind$BPrintMemUsage DD 010401H
	DD	08204H
xdata	ENDS
; Function compile flags: /Odtp
; File W:\Butterfly\Butterfly\src\Core\BMemory.c
_TEXT	SEGMENT
TypeIndex$1 = 48
BPrintMemUsage PROC

; 46   : {

$LN6:
  00000	48 83 ec 48	 sub	 rsp, 72			; 00000048H

; 47   :     BDEBUG("Total Memory Allocated: %lu bytes", MemoryStats.TotalAllocated);

  00004	4c 8b 0d 00 00
	00 00		 mov	 r9, QWORD PTR MemoryStats
  0000b	4c 8d 05 00 00
	00 00		 lea	 r8, OFFSET FLAT:$SG117932
  00012	48 8d 15 00 00
	00 00		 lea	 rdx, OFFSET FLAT:$SG117933
  00019	b9 04 00 00 00	 mov	 ecx, 4
  0001e	e8 00 00 00 00	 call	 BLogMessage

; 48   :     for(int TypeIndex = 0;

  00023	c7 44 24 30 00
	00 00 00	 mov	 DWORD PTR TypeIndex$1[rsp], 0
  0002b	eb 0a		 jmp	 SHORT $LN4@BPrintMemU
$LN2@BPrintMemU:

; 50   :         ++TypeIndex)

  0002d	8b 44 24 30	 mov	 eax, DWORD PTR TypeIndex$1[rsp]
  00031	ff c0		 inc	 eax
  00033	89 44 24 30	 mov	 DWORD PTR TypeIndex$1[rsp], eax
$LN4@BPrintMemU:

; 49   :         TypeIndex < MEM_TYPE_COUNT;

  00037	83 7c 24 30 02	 cmp	 DWORD PTR TypeIndex$1[rsp], 2
  0003c	7d 3f		 jge	 SHORT $LN3@BPrintMemU

; 51   :     {
; 52   :         BDEBUG("Total Memory Allocated for %s is %lu bytes", MemTypeStrings[TypeIndex], MemoryStats.TypeAllocated[TypeIndex]);

  0003e	48 63 44 24 30	 movsxd	 rax, DWORD PTR TypeIndex$1[rsp]
  00043	48 8d 0d 08 00
	00 00		 lea	 rcx, OFFSET FLAT:MemoryStats+8
  0004a	48 63 54 24 30	 movsxd	 rdx, DWORD PTR TypeIndex$1[rsp]
  0004f	4c 8d 05 00 00
	00 00		 lea	 r8, OFFSET FLAT:MemTypeStrings
  00056	48 8b 04 c1	 mov	 rax, QWORD PTR [rcx+rax*8]
  0005a	48 89 44 24 20	 mov	 QWORD PTR [rsp+32], rax
  0005f	4d 8b 0c d0	 mov	 r9, QWORD PTR [r8+rdx*8]
  00063	4c 8d 05 00 00
	00 00		 lea	 r8, OFFSET FLAT:$SG117934
  0006a	48 8d 15 00 00
	00 00		 lea	 rdx, OFFSET FLAT:$SG117935
  00071	b9 04 00 00 00	 mov	 ecx, 4
  00076	e8 00 00 00 00	 call	 BLogMessage

; 53   :     }

  0007b	eb b0		 jmp	 SHORT $LN2@BPrintMemU
$LN3@BPrintMemU:

; 54   : }

  0007d	48 83 c4 48	 add	 rsp, 72			; 00000048H
  00081	c3		 ret	 0
BPrintMemUsage ENDP
_TEXT	ENDS
; Function compile flags: /Odtp
; File W:\Butterfly\Butterfly\src\Core\BMemory.c
_TEXT	SEGMENT
Type$ = 48
Memory$ = 56
Size$ = 64
BFree	PROC

; 33   : {

$LN4:
  00000	4c 89 44 24 18	 mov	 QWORD PTR [rsp+24], r8
  00005	48 89 54 24 10	 mov	 QWORD PTR [rsp+16], rdx
  0000a	89 4c 24 08	 mov	 DWORD PTR [rsp+8], ecx
  0000e	48 83 ec 28	 sub	 rsp, 40			; 00000028H

; 34   :     if(Type == MEM_TYPE_UNKNOWN)

  00012	83 7c 24 30 00	 cmp	 DWORD PTR Type$[rsp], 0
  00017	75 18		 jne	 SHORT $LN2@BFree

; 35   :     {
; 36   :         BWARN("\"BFree\" called with \"MEM_TYPE_UNKNOWN\", please re-type this");

  00019	4c 8d 05 00 00
	00 00		 lea	 r8, OFFSET FLAT:$SG117924
  00020	48 8d 15 00 00
	00 00		 lea	 rdx, OFFSET FLAT:$SG117925
  00027	b9 02 00 00 00	 mov	 ecx, 2
  0002c	e8 00 00 00 00	 call	 BLogMessage
$LN2@BFree:

; 37   :     }
; 38   :     
; 39   :     MemoryStats.TotalAllocated -= Size;

  00031	48 8b 44 24 40	 mov	 rax, QWORD PTR Size$[rsp]
  00036	48 8b 0d 00 00
	00 00		 mov	 rcx, QWORD PTR MemoryStats
  0003d	48 2b c8	 sub	 rcx, rax
  00040	48 8b c1	 mov	 rax, rcx
  00043	48 89 05 00 00
	00 00		 mov	 QWORD PTR MemoryStats, rax

; 40   :     MemoryStats.TypeAllocated[Type] -= Size;

  0004a	48 63 44 24 30	 movsxd	 rax, DWORD PTR Type$[rsp]
  0004f	48 8d 0d 08 00
	00 00		 lea	 rcx, OFFSET FLAT:MemoryStats+8
  00056	48 8b 54 24 40	 mov	 rdx, QWORD PTR Size$[rsp]
  0005b	48 8b 04 c1	 mov	 rax, QWORD PTR [rcx+rax*8]
  0005f	48 2b c2	 sub	 rax, rdx
  00062	48 63 4c 24 30	 movsxd	 rcx, DWORD PTR Type$[rsp]
  00067	48 8d 15 08 00
	00 00		 lea	 rdx, OFFSET FLAT:MemoryStats+8
  0006e	48 89 04 ca	 mov	 QWORD PTR [rdx+rcx*8], rax

; 41   :     
; 42   :     BPlatformFree(Memory, Size);

  00072	48 8b 54 24 40	 mov	 rdx, QWORD PTR Size$[rsp]
  00077	48 8b 4c 24 38	 mov	 rcx, QWORD PTR Memory$[rsp]
  0007c	e8 00 00 00 00	 call	 BPlatformFree

; 43   : }

  00081	48 83 c4 28	 add	 rsp, 40			; 00000028H
  00085	c3		 ret	 0
BFree	ENDP
_TEXT	ENDS
; Function compile flags: /Odtp
; File W:\Butterfly\Butterfly\src\Core\BMemory.c
_TEXT	SEGMENT
Memory$ = 32
Type$ = 64
Size$ = 72
BAlloc	PROC

; 19   : {

$LN4:
  00000	48 89 54 24 10	 mov	 QWORD PTR [rsp+16], rdx
  00005	89 4c 24 08	 mov	 DWORD PTR [rsp+8], ecx
  00009	48 83 ec 38	 sub	 rsp, 56			; 00000038H

; 20   :     if(Type == MEM_TYPE_UNKNOWN)

  0000d	83 7c 24 40 00	 cmp	 DWORD PTR Type$[rsp], 0
  00012	75 18		 jne	 SHORT $LN2@BAlloc

; 21   :     {
; 22   :         BWARN("\"BAlloc\" called with \"MEM_TYPE_UNKNOWN\", please re-type this");

  00014	4c 8d 05 00 00
	00 00		 lea	 r8, OFFSET FLAT:$SG117914
  0001b	48 8d 15 00 00
	00 00		 lea	 rdx, OFFSET FLAT:$SG117915
  00022	b9 02 00 00 00	 mov	 ecx, 2
  00027	e8 00 00 00 00	 call	 BLogMessage
$LN2@BAlloc:

; 23   :     }
; 24   :     
; 25   :     MemoryStats.TotalAllocated += Size;

  0002c	48 8b 44 24 48	 mov	 rax, QWORD PTR Size$[rsp]
  00031	48 8b 0d 00 00
	00 00		 mov	 rcx, QWORD PTR MemoryStats
  00038	48 03 c8	 add	 rcx, rax
  0003b	48 8b c1	 mov	 rax, rcx
  0003e	48 89 05 00 00
	00 00		 mov	 QWORD PTR MemoryStats, rax

; 26   :     MemoryStats.TypeAllocated[Type] += Size;

  00045	48 63 44 24 40	 movsxd	 rax, DWORD PTR Type$[rsp]
  0004a	48 8d 0d 08 00
	00 00		 lea	 rcx, OFFSET FLAT:MemoryStats+8
  00051	48 8b 04 c1	 mov	 rax, QWORD PTR [rcx+rax*8]
  00055	48 03 44 24 48	 add	 rax, QWORD PTR Size$[rsp]
  0005a	48 63 4c 24 40	 movsxd	 rcx, DWORD PTR Type$[rsp]
  0005f	48 8d 15 08 00
	00 00		 lea	 rdx, OFFSET FLAT:MemoryStats+8
  00066	48 89 04 ca	 mov	 QWORD PTR [rdx+rcx*8], rax

; 27   :     
; 28   :     void *Memory = BPlatformAlloc(Size);

  0006a	48 8b 4c 24 48	 mov	 rcx, QWORD PTR Size$[rsp]
  0006f	e8 00 00 00 00	 call	 BPlatformAlloc
  00074	48 89 44 24 20	 mov	 QWORD PTR Memory$[rsp], rax

; 29   :     return Memory;

  00079	48 8b 44 24 20	 mov	 rax, QWORD PTR Memory$[rsp]

; 30   : }

  0007e	48 83 c4 38	 add	 rsp, 56			; 00000038H
  00082	c3		 ret	 0
BAlloc	ENDP
_TEXT	ENDS
END
